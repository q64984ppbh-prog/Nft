<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP! CRASH GAME</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary-blue: #2D8CFF;
            --accent-blue: #1A6FD6;
            --dark-bg: #0A0A0F;
            --panel-dark: #111116;
            --panel-medium: #1A1A20;
            --panel-light: #222228;
            --text-primary: #FFFFFF;
            --text-secondary: #8C8E94;
            --success-green: #00CC66;
            --danger-red: #FF4A6E;
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 70px;
        }
        
        /* –ü–ê–î–ê–Æ–©–ò–ï –®–ê–†–ò–ö–ò */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            animation: float linear infinite;
        }
        
        @keyframes float {
            from { transform: translateY(-100px) translateX(0); }
            to { transform: translateY(100vh) translateX(-200px); }
        }
        
        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø –í–ù–ò–ó–£ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--panel-dark);
            border-top: 1px solid #2A2A30;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 1000;
        }
        
        .nav-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 8px 16px;
            border-radius: 12px;
        }
        
        .nav-btn.active {
            color: var(--primary-blue);
        }
        
        .nav-icon {
            font-size: 20px;
        }
        
        /* –ò–ì–†–û–í–ê–Ø –û–ë–õ–ê–°–¢–¨ */
        .game-area {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* –û–¢–°–ß–ï–¢ –ò –†–ê–ö–ï–¢–ê */
        .rocket-display {
            height: 300px;
            position: relative;
            margin: 20px 0 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-radius: 20px;
            background: rgba(10, 10, 15, 0.8);
        }
        
        .countdown-display {
            font-size: 120px;
            font-weight: 900;
            color: white;
            text-shadow: 0 0 40px rgba(45, 140, 255, 0.8);
            z-index: 2;
        }
        
        .rocket-gif {
            position: absolute;
            width: 150px;
            height: auto;
            z-index: 2;
            display: none;
        }
        
        .pulse-animation {
            animation: rocketPulse 0.5s ease-in-out infinite alternate;
        }
        
        @keyframes rocketPulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }
        
        /* –ò–ù–§–û–ü–ê–ù–ï–õ–¨ */
        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }
        
        .status-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .current-multiplier {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, #2D8CFF, #1A6FD6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* –ú–ù–û–ñ–ò–¢–ï–õ–ò (–ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–´–ô –°–ö–†–û–õ–õ) */
        .multipliers-scroll {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            margin: 25px 0;
            padding: 10px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .multipliers-scroll::-webkit-scrollbar {
            display: none;
        }
        
        .multiplier-btn {
            flex: 0 0 auto;
            background: var(--panel-medium);
            border: 1px solid #2A2A30;
            border-radius: 12px;
            padding: 14px 20px;
            font-size: 15px;
            font-weight: 700;
            color: var(--text-secondary);
            text-align: center;
            min-width: 80px;
            transition: all 0.2s ease;
            cursor: default;
            user-select: none;
        }
        
        .multiplier-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }
        
        .multiplier-btn.awaiting {
            color: var(--text-primary);
        }
        
        /* –ö–ù–û–ü–ö–ê –°–¢–ê–í–ö–ò */
        .bet-button-container {
            margin: 30px 0;
        }
        
        .main-bet-btn {
            width: 100%;
            background: linear-gradient(135deg, #2D8CFF, #1A6FD6);
            border: none;
            border-radius: 16px;
            padding: 22px;
            font-size: 18px;
            font-weight: 800;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(45, 140, 255, 0.3);
            letter-spacing: 0.5px;
        }
        
        .main-bet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(45, 140, 255, 0.5);
        }
        
        .main-bet-btn:disabled {
            background: #444;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .main-bet-btn.cashout {
            background: linear-gradient(135deg, var(--success-green), #00AA55);
        }
        
        /* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –°–¢–ê–í–ö–ò */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .modal-content {
            background: var(--panel-dark);
            border-radius: 24px;
            width: 90%;
            max-width: 400px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            padding: 24px;
            border-bottom: 1px solid #2A2A30;
            text-align: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .modal-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .currency-selector {
            display: flex;
            background: var(--panel-medium);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 24px;
        }
        
        .currency-option {
            flex: 1;
            padding: 16px;
            text-align: center;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .currency-option.active {
            background: var(--primary-blue);
            color: white;
        }
        
        .amount-input-container {
            position: relative;
            margin-bottom: 24px;
        }
        
        .amount-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #2A2A30;
            border-radius: 16px;
            padding: 20px;
            font-size: 32px;
            font-weight: 800;
            color: var(--text-primary);
            text-align: center;
            outline: none;
            transition: border-color 0.2s ease;
        }
        
        .amount-input:focus {
            border-color: var(--primary-blue);
        }
        
        .currency-label {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 600;
        }
        
        .quick-amounts {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 24px;
        }
        
        .quick-amount-btn {
            padding: 14px 5px;
            background: var(--panel-medium);
            border: 1px solid #2A2A30;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .quick-amount-btn:hover {
            background: var(--panel-light);
        }
        
        .modal-actions {
            display: flex;
            gap: 12px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .modal-btn.primary {
            background: var(--primary-blue);
            color: white;
        }
        
        .modal-btn.secondary {
            background: var(--panel-medium);
            color: var(--text-primary);
            border: 1px solid #2A2A30;
        }
        
        /* –°–ü–ò–°–û–ö –°–¢–ê–í–û–ö */
        .bets-container {
            background: var(--panel-medium);
            border-radius: 20px;
            overflow: hidden;
            margin-top: 25px;
        }
        
        .bets-header {
            padding: 18px 20px;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid #2A2A30;
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            justify-content: space-between;
        }
        
        .bets-list {
            min-height: 120px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .bet-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .bet-item:last-child {
            border-bottom: none;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, #2D8CFF, #1A6FD6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-size: 15px;
            font-weight: 600;
        }
        
        .user-bet-target {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        .bet-amount {
            font-size: 17px;
            font-weight: 700;
            text-align: right;
        }
        
        .bet-profit {
            font-size: 15px;
            color: var(--success-green);
            font-weight: 600;
            margin-top: 3px;
        }
        
        .no-bets {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 120px;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 500;
        }
        
        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        @keyframes countdownPop {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .countdown-animation {
            animation: countdownPop 0.5s ease-out;
        }
        
        @keyframes crashExplosion {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        .crash-animation {
            animation: crashExplosion 1s ease-out forwards;
        }
        
        /* –î–†–£–ì–ò–ï –°–¢–†–ê–ù–ò–¶–´ */
        .page {
            display: none;
            padding: 20px;
        }
        
        .page.active {
            display: block;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 800;
            margin: 40px 0;
            text-align: center;
            color: var(--text-secondary);
        }
        
        /* –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ê–Ø –°–¢–ê–í–ö–ê */
        .user-bet-info {
            background: rgba(45, 140, 255, 0.1);
            border: 1px solid rgba(45, 140, 255, 0.3);
            border-radius: 16px;
            padding: 16px;
            margin: 20px 0;
            display: none;
        }
        
        .user-bet-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .user-bet-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .user-bet-value {
            font-weight: 700;
            font-size: 16px;
        }
        
        .user-profit {
            color: var(--success-green);
        }
    </style>
</head>
<body>
    <!-- –ü–ê–î–ê–Æ–©–ò–ï –®–ê–†–ò–ö–ò -->
    <div class="particles" id="particles"></div>
    
    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
    <div class="game-area">
        <!-- –û–¢–°–ß–ï–¢ –ò –†–ê–ö–ï–¢–ê -->
        <div class="rocket-display">
            <div class="countdown-display" id="countdownDisplay">7</div>
            <img src="gifs/fly.gif" class="rocket-gif" id="rocketGif" alt="–†–∞–∫–µ—Ç–∞">
            <img src="gifs/crash.gif" class="rocket-gif" id="crashGif" alt="–í–∑—Ä—ã–≤">
        </div>
        
        <!-- –ò–ù–§–û–ü–ê–ù–ï–õ–¨ -->
        <div class="game-info">
            <div class="status-label" id="statusLabel">–û–∂–∏–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–æ–∫</div>
            <div class="current-multiplier" id="currentMultiplier">1.00x</div>
        </div>
        
        <!-- –ú–ù–û–ñ–ò–¢–ï–õ–ò –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–´–ô –°–ö–†–û–õ–õ -->
        <div class="multipliers-scroll" id="multipliersScroll">
            <div class="multiplier-btn awaiting" id="multiplier1">–û–∂–∏–¥–∞–Ω–∏–µ</div>
            <div class="multiplier-btn" id="multiplier2">1.50x</div>
            <div class="multiplier-btn" id="multiplier3">2.00x</div>
            <div class="multiplier-btn" id="multiplier4">3.00x</div>
            <div class="multiplier-btn" id="multiplier5">5.00x</div>
            <div class="multiplier-btn" id="multiplier6">10.00x</div>
            <div class="multiplier-btn" id="multiplier7">20.00x</div>
            <div class="multiplier-btn" id="multiplier8">50.00x</div>
        </div>
        
        <!-- –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –°–¢–ê–í–ö–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø -->
        <div class="user-bet-info" id="userBetInfo">
            <div class="user-bet-row">
                <span class="user-bet-label">–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞:</span>
                <span class="user-bet-value" id="userBetAmount">0 TON</span>
            </div>
            <div class="user-bet-row">
                <span class="user-bet-label">–¢–µ–∫—É—â–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å:</span>
                <span class="user-bet-value" id="userCurrentMultiplier">1.00x</span>
            </div>
            <div class="user-bet-row">
                <span class="user-bet-label">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à:</span>
                <span class="user-bet-value user-profit" id="userPotentialWin">0 TON</span>
            </div>
        </div>
        
        <!-- –ö–ù–û–ü–ö–ê –°–¢–ê–í–ö–ò/–í–´–í–û–î–ê -->
        <div class="bet-button-container">
            <button class="main-bet-btn" id="placeBetBtn">–°–î–ï–õ–ê–¢–¨ –°–¢–ê–í–ö–£</button>
        </div>
        
        <!-- –°–ü–ò–°–û–ö –°–¢–ê–í–û–ö -->
        <div class="bets-container">
            <div class="bets-header">
                <span>–ò–ì–†–û–ö–ò</span>
                <span>–°–¢–ê–í–ö–ê</span>
            </div>
            <div class="bets-list" id="betsList">
                <!-- –°—Ç–∞–≤–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
            </div>
        </div>
    </div>
    
    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –°–¢–ê–í–ö–ò -->
    <div class="modal-overlay" id="betModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É</div>
                <div class="modal-subtitle">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: 10 TON</div>
            </div>
            <div class="modal-body">
                <div class="currency-selector">
                    <button class="currency-option active" data-currency="TON">TON</button>
                </div>
                
                <div class="amount-input-container">
                    <input type="number" class="amount-input" id="modalBetAmount" value="250" min="10" step="10">
                    <div class="currency-label">TON</div>
                </div>
                
                <div class="quick-amounts">
                    <button class="quick-amount-btn" data-amount="10">+10</button>
                    <button class="quick-amount-btn" data-amount="50">+50</button>
                    <button class="quick-amount-btn" data-amount="100">+100</button>
                    <button class="quick-amount-btn" data-action="half">1/2</button>
                    <button class="quick-amount-btn" data-action="double">x2</button>
                    <button class="quick-amount-btn" data-action="max">MAX</button>
                    <button class="quick-amount-btn" data-action="min">MIN</button>
                    <button class="quick-amount-btn" data-action="clear">CLEAR</button>
                </div>
                
                <div class="modal-actions">
                    <button class="modal-btn secondary" id="cancelBetBtn">–û–¢–ú–ï–ù–ê</button>
                    <button class="modal-btn primary" id="confirmBetBtn">–ü–û–î–¢–í–ï–†–î–ò–¢–¨</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –î–†–£–ì–ò–ï –°–¢–†–ê–ù–ò–¶–´ -->
    <div id="page-rocket" class="page">
        <div class="page-title">–ú–û–Ø –†–ê–ö–ï–¢–ê</div>
    </div>
    
    <div id="page-profile" class="page">
        <div class="page-title">–ü–†–û–§–ò–õ–¨</div>
    </div>
    
    <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
    <div class="bottom-nav">
        <button class="nav-btn active" data-page="game">
            <span class="nav-icon">üéØ</span>
            –ö—Ä–∞—à
        </button>
        <button class="nav-btn" data-page="rocket">
            <span class="nav-icon">üöÄ</span>
            –†–∞–∫–µ—Ç–∞
        </button>
        <button class="nav-btn" data-page="profile">
            <span class="nav-icon">üë§</span>
            –ü—Ä–æ—Ñ–∏–ª—å
        </button>
    </div>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.setBackgroundColor('#0A0A0F');
        tg.setHeaderColor('#0A0A0F');
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        const gameState = {
            phase: 'COUNTDOWN',
            countdown: 7,
            currentMultiplier: 1.0,
            crashMultiplier: null,
            isBettingOpen: true,
            bets: [],
            userBalance: 1000,
            userBet: null,
            gameInterval: null,
            multiplierSpeed: 0.01,
            multiplierTimer: null
        };
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const elements = {
            countdownDisplay: document.getElementById('countdownDisplay'),
            rocketGif: document.getElementById('rocketGif'),
            crashGif: document.getElementById('crashGif'),
            statusLabel: document.getElementById('statusLabel'),
            currentMultiplier: document.getElementById('currentMultiplier'),
            placeBetBtn: document.getElementById('placeBetBtn'),
            betsList: document.getElementById('betsList'),
            userBetInfo: document.getElementById('userBetInfo'),
            userBetAmount: document.getElementById('userBetAmount'),
            userCurrentMultiplier: document.getElementById('userCurrentMultiplier'),
            userPotentialWin: document.getElementById('userPotentialWin'),
            betModal: document.getElementById('betModal'),
            modalBetAmount: document.getElementById('modalBetAmount'),
            cancelBetBtn: document.getElementById('cancelBetBtn'),
            confirmBetBtn: document.getElementById('confirmBetBtn'),
            multipliersScroll: document.getElementById('multipliersScroll')
        };
        
        // –ú–Ω–æ–∂–∏—Ç–µ–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        const multiplierValues = [
            { id: 'multiplier1', value: null, label: '–û–∂–∏–¥–∞–Ω–∏–µ' },
            { id: 'multiplier2', value: 1.5 },
            { id: 'multiplier3', value: 2.0 },
            { id: 'multiplier4', value: 3.0 },
            { id: 'multiplier5', value: 5.0 },
            { id: 'multiplier6', value: 10.0 },
            { id: 'multiplier7', value: 20.0 },
            { id: 'multiplier8', value: 50.0 }
        ];
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–¥–∞—é—â–∏—Ö —à–∞—Ä–∏–∫–æ–≤
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${10 + Math.random() * 20}s`;
                particle.style.opacity = `${0.2 + Math.random() * 0.3}`;
                
                container.appendChild(particle);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞–≤–∫–∏
        function updateBetButton() {
            if (gameState.userBet) {
                elements.placeBetBtn.textContent = `–ó–ê–ë–†–ê–¢–¨ ${Math.floor(gameState.userBet.amount * gameState.currentMultiplier)} TON`;
                elements.placeBetBtn.classList.add('cashout');
            } else {
                elements.placeBetBtn.textContent = '–°–î–ï–õ–ê–¢–¨ –°–¢–ê–í–ö–£';
                elements.placeBetBtn.classList.remove('cashout');
            }
            
            elements.placeBetBtn.disabled = !gameState.isBettingOpen && !gameState.userBet;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç–∞–≤–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateUserBetInfo() {
            if (gameState.userBet) {
                elements.userBetInfo.style.display = 'block';
                elements.userBetAmount.textContent = `${gameState.userBet.amount} TON`;
                elements.userCurrentMultiplier.textContent = `${gameState.currentMultiplier.toFixed(2)}x`;
                
                const potentialWin = gameState.userBet.amount * gameState.currentMultiplier;
                elements.userPotentialWin.textContent = `${Math.floor(potentialWin)} TON`;
            } else {
                elements.userBetInfo.style.display = 'none';
            }
        }
        
        // –û—Ç—Å—á–µ—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
        function startCountdown() {
            gameState.phase = 'COUNTDOWN';
            gameState.countdown = 7;
            gameState.isBettingOpen = true;
            gameState.currentMultiplier = 1.0;
            
            // –°–±—Ä–æ—Å —Å—Ç–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            gameState.userBet = null;
            
            elements.statusLabel.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–æ–∫';
            elements.currentMultiplier.textContent = '1.00x';
            elements.countdownDisplay.textContent = gameState.countdown;
            elements.countdownDisplay.style.display = 'block';
            elements.rocketGif.style.display = 'none';
            elements.crashGif.style.display = 'none';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π
            updateMultiplierButtons();
            
            updateBetButton();
            updateUserBetInfo();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Ç—Å—á–µ—Ç
            const countdownInterval = setInterval(() => {
                gameState.countdown--;
                elements.countdownDisplay.textContent = gameState.countdown;
                elements.countdownDisplay.classList.add('countdown-animation');
                
                setTimeout(() => {
                    elements.countdownDisplay.classList.remove('countdown-animation');
                }, 500);
                
                if (gameState.countdown <= 0) {
                    clearInterval(countdownInterval);
                    startRocketFlight();
                }
            }, 1000);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π
        function updateMultiplierButtons() {
            multiplierValues.forEach((mult, index) => {
                const btn = document.getElementById(mult.id);
                if (index === 0) {
                    btn.textContent = gameState.phase === 'COUNTDOWN' ? '–û–∂–∏–¥–∞–Ω–∏–µ' : '1.00x';
                    btn.className = gameState.phase === 'COUNTDOWN' ? 'multiplier-btn awaiting' : 'multiplier-btn active';
                } else {
                    btn.textContent = `${mult.value.toFixed(2)}x`;
                    btn.className = 'multiplier-btn';
                    
                    if (gameState.currentMultiplier >= mult.value) {
                        btn.classList.add('active');
                    }
                }
            });
        }
        
        // –ü–æ–ª—ë—Ç —Ä–∞–∫–µ—Ç—ã
        function startRocketFlight() {
            gameState.phase = 'FLYING';
            gameState.isBettingOpen = false;
            gameState.crashMultiplier = 1.0 + Math.random() * 49;
            
            elements.statusLabel.textContent = '–†–∞–∫–µ—Ç–∞ –ª–µ—Ç–∏—Ç!';
            elements.countdownDisplay.style.display = 'none';
            elements.rocketGif.style.display = 'block';
            elements.rocketGif.classList.add('pulse-animation');
            
            updateBetButton();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è —Å —Ä–∞–∑–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é
            clearInterval(gameState.multiplierTimer);
            gameState.multiplierTimer = setInterval(() => {
                // –ú–µ–Ω—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –º–Ω–æ–∂–∏—Ç–µ–ª—è
                if (gameState.currentMultiplier < 2) {
                    gameState.multiplierSpeed = 0.01;
                } else {
                    gameState.multiplierSpeed = 0.03;
                }
                
                gameState.currentMultiplier += gameState.multiplierSpeed;
                elements.currentMultiplier.textContent = gameState.currentMultiplier.toFixed(2) + 'x';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π
                updateMultiplierButtons();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞–≤–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                updateUserBetInfo();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∞—à
                if (gameState.currentMultiplier >= gameState.crashMultiplier) {
                    clearInterval(gameState.multiplierTimer);
                    crashRocket();
                }
            }, 500); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 0.5 —Å–µ–∫—É–Ω–¥—ã
        }
        
        // –í–∑—Ä—ã–≤ —Ä–∞–∫–µ—Ç—ã
        function crashRocket() {
            gameState.phase = 'CRASHED';
            
            elements.rocketGif.style.display = 'none';
            elements.crashGif.style.display = 'block';
            elements.crashGif.classList.add('crash-animation');
            
            elements.statusLabel.textContent = '–ö–†–ê–®!';
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã–∏–≥—Ä—ã—à–∏
            calculateWinnings();
            
            // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π –æ—Ç—Å—á–µ—Ç
            setTimeout(() => {
                startCountdown();
            }, 3000);
        }
        
        // –†–∞—Å—á–µ—Ç –≤—ã–∏–≥—Ä—ã—à–µ–π
        function calculateWinnings() {
            if (gameState.userBet) {
                const userWin = gameState.userBet.amount * gameState.currentMultiplier;
                gameState.userBalance += userWin;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–∏–≥—Ä—ã—à
                tg.showPopup({
                    title: '–í—ã–∏–≥—Ä—ã—à!',
                    message: `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${Math.floor(userWin)} TON`,
                    buttons: [{ type: 'ok' }]
                });
                
                gameState.userBet = null;
                updateUserBetInfo();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥—Ä—É–≥–∏–µ —Å—Ç–∞–≤–∫–∏
            gameState.bets.forEach(bet => {
                if (bet.targetMultiplier <= gameState.crashMultiplier) {
                    bet.profit = bet.amount * bet.targetMultiplier;
                    bet.won = true;
                } else {
                    bet.won = false;
                }
            });
            
            updateBetsList();
            updateBetButton();
        }
        
        // –ó–∞–±—Ä–∞—Ç—å —Å—Ç–∞–≤–∫—É –¥–æ—Å—Ä–æ—á–Ω–æ
        function cashoutBet() {
            if (!gameState.userBet || gameState.phase === 'CRASHED') return;
            
            const winAmount = gameState.userBet.amount * gameState.currentMultiplier;
            gameState.userBalance += winAmount;
            
            tg.showPopup({
                title: '–í—ã–≤–æ–¥!',
                message: `–í—ã –≤—ã–≤–µ–ª–∏ ${Math.floor(winAmount)} TON`,
                buttons: [{ type: 'ok' }]
            });
            
            gameState.userBet = null;
            updateUserBetInfo();
            updateBetButton();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞–≤–æ–∫
        function updateBetsList() {
            elements.betsList.innerHTML = '';
            
            if (gameState.bets.length === 0) {
                elements.betsList.innerHTML = '<div class="no-bets">–û–∂–∏–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–æ–∫</div>';
                return;
            }
            
            gameState.bets.forEach(bet => {
                const betItem = document.createElement('div');
                betItem.className = 'bet-item';
                
                betItem.innerHTML = `
                    <div class="user-info">
                        <div class="user-avatar">${bet.name.charAt(0)}</div>
                        <div class="user-details">
                            <div class="user-name">${bet.name}</div>
                            <div class="user-bet-target">—Å—Ç–∞–≤–∏—Ç –Ω–∞ ${bet.targetMultiplier.toFixed(2)}x</div>
                        </div>
                    </div>
                    <div>
                        <div class="bet-amount">${bet.amount} TON</div>
                        ${bet.profit ? `<div class="bet-profit">+${bet.profit.toFixed(2)} TON</div>` : ''}
                    </div>
                `;
                
                elements.betsList.appendChild(betItem);
            });
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å—Ç–∞–≤–∫–∏
        elements.placeBetBtn.addEventListener('click', () => {
            if (gameState.userBet) {
                cashoutBet();
                return;
            }
            
            if (!gameState.isBettingOpen) return;
            
            elements.modalBetAmount.value = '250';
            elements.betModal.style.display = 'flex';
            tg.HapticFeedback.impactOccurred('light');
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        elements.cancelBetBtn.addEventListener('click', () => {
            elements.betModal.style.display = 'none';
        });
        
        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
        elements.confirmBetBtn.addEventListener('click', () => {
            const amount = parseInt(elements.modalBetAmount.value);
            
            if (amount < 10 || amount > gameState.userBalance) {
                tg.showPopup({
                    title: '–û—à–∏–±–∫–∞',
                    message: `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: 10 TON\n–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è: ${gameState.userBalance} TON`,
                    buttons: [{ type: 'ok' }]
                });
                return;
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å
            const availableMultipliers = multiplierValues.slice(1).map(m => m.value);
            const targetMultiplier = availableMultipliers[Math.floor(Math.random() * availableMultipliers.length)];
            
            // –°–æ–∑–¥–∞–µ–º —Å—Ç–∞–≤–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            gameState.userBet = {
                amount: amount,
                targetMultiplier: targetMultiplier
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫
            gameState.bets.unshift({
                name: '–í—ã',
                amount: amount,
                targetMultiplier: targetMultiplier,
                profit: null,
                won: false
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
            gameState.userBalance -= amount;
            
            // –í–∏–±—Ä–∞—Ü–∏—è
            tg.HapticFeedback.impactOccurred('medium');
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            elements.betModal.style.display = 'none';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateBetsList();
            updateBetButton();
            updateUserBetInfo();
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –±—ã—Å—Ç—Ä—ã—Ö –∫–Ω–æ–ø–æ–∫ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        document.querySelectorAll('.quick-amount-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                let current = parseInt(elements.modalBetAmount.value) || 0;
                const action = btn.dataset.action;
                const amount = btn.dataset.amount;
                
                if (amount) {
                    current += parseInt(amount);
                } else {
                    switch(action) {
                        case 'half': current = Math.floor(current / 2); break;
                        case 'double': current *= 2; break;
                        case 'max': current = gameState.userBalance; break;
                        case 'min': current = 10; break;
                        case 'clear': current = 0; break;
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∏
                if (current > gameState.userBalance) current = gameState.userBalance;
                if (current < 10) current = 10;
                
                elements.modalBetAmount.value = current;
                tg.HapticFeedback.impactOccurred('light');
            });
        });
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const page = btn.dataset.page;
                
                // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                document.getElementById(`page-${page}`).classList.add('active');
                btn.classList.add('active');
                
                // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∏–≥—Ä–æ–≤—É—é –æ–±–ª–∞—Å—Ç—å
                const gameArea = document.querySelector('.game-area');
                gameArea.style.display = page === 'game' ? 'block' : 'none';
                
                tg.HapticFeedback.impactOccurred('light');
            });
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            createParticles();
            startCountdown();
            updateBetButton();
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–≤–æ–∫ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            setTimeout(() => {
                gameState.bets = [
                    { name: "trumtory", amount: 22.27, targetMultiplier: 2.0, profit: null },
                    { name: "–ú–∞—Ä–∞—Ç", amount: 15.50, targetMultiplier: 5.0, profit: null },
                    { name: "–ê–ª–µ–∫—Å–µ–π", amount: 8.90, targetMultiplier: 3.0, profit: null }
                ];
                updateBetsList();
            }, 1000);
        });
    </script>
</body>
</html>
